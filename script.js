const ZERO="\u200B";const ONE="\u200C";const FLAG="\u200D";const els={cover:document.getElementById("cover-text"),secret:document.getElementById("secret-message"),btnEncode:document.getElementById("btn-encode"),outEncodeBox:document.getElementById("encode-output"),outEncodeText:document.getElementById("encode-text-display"),copyBtn:document.getElementById("copy-encode"),decodeInput:document.getElementById("decode-input"),highlightLayer:document.getElementById("highlight-layer"),btnDecode:document.getElementById("btn-decode"),outDecodeBox:document.getElementById("decode-output"),outDecodeText:document.getElementById("decode-text-display"),toast:document.getElementById("toast"),toastMsg:document.getElementById("toast-msg"),hiddenClipboard:document.getElementById("hidden-copy-area"),};const textToBinary=(str)=>str.split("").map((char)=>char.charCodeAt(0).toString(2).padStart(8,"0")).join("");const binaryToText=(bin)=>{let str="";for(let i=0;i<bin.length;i+=8){str+=String.fromCharCode(parseInt(bin.substr(i,8),2))}
return str};const escapeHtml=(unsafe)=>{return unsafe.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\n/g,"<br>")};const showToast=(msg,isError=!1)=>{els.toastMsg.textContent=msg;els.toast.querySelector("i").className=isError?"ri-error-warning-fill":"ri-checkbox-circle-fill";els.toast.querySelector("i").style.color=isError?"#ef4444":"#38bdf8";els.toast.classList.add("visible");setTimeout(()=>els.toast.classList.remove("visible"),3000)};function encodeMessage(){const cover=els.cover.value;const secret=els.secret.value;if(!cover||!secret){showToast("Please enter both cover text and secret.",!0);return}
els.btnEncode.classList.add("btn-loading");setTimeout(()=>{const binary=textToBinary(secret);const hiddenStr=binary.split("").map((b)=>(b==="0"?ZERO:ONE)).join("");const payload=FLAG+hiddenStr+FLAG;const stegoText=cover.length>0?cover[0]+payload+cover.slice(1):payload;els.outEncodeBox.classList.add("success");els.outEncodeText.textContent=stegoText;els.hiddenClipboard.value=stegoText;els.copyBtn.style.display="block";els.btnEncode.classList.remove("btn-loading");showToast("Message hidden successfully!")},500)}
function copyToClipboard(){els.hiddenClipboard.select();navigator.clipboard.writeText(els.hiddenClipboard.value).then(()=>{showToast("Stego-text copied to clipboard")})}
function decodeMessage(){const text=els.decodeInput.value;els.btnDecode.classList.add("btn-loading");els.highlightLayer.innerHTML=escapeHtml(text);els.outDecodeBox.classList.remove("success");setTimeout(()=>{const regex=/\u200D([\u200B\u200C]+)\u200D/;const match=text.match(regex);els.btnDecode.classList.remove("btn-loading");if(match){try{const hiddenBinary=match[1].split("").map((c)=>(c===ZERO?"0":"1")).join("");const decodedMsg=binaryToText(hiddenBinary);els.outDecodeBox.classList.add("success");els.outDecodeText.innerHTML=`<span style="color:#fff">Secret:</span> ${escapeHtml(decodedMsg)}`;showToast("Hidden payload detected!");const startIndex=match.index;const endIndex=startIndex+match[0].length;const before=text.substring(0,startIndex);const payload=text.substring(startIndex,endIndex);const after=text.substring(endIndex);els.highlightLayer.innerHTML=escapeHtml(before)+'<span class="marker"></span>'+escapeHtml(after);syncScroll()}catch(e){showToast("Corrupted data found.",!0);els.outDecodeText.textContent="Error: Data corrupted."}}else{els.outDecodeText.textContent="No invisible data found.";showToast("Scan complete. Clean.",!0)}},600)}
const syncScroll=()=>{els.highlightLayer.scrollTop=els.decodeInput.scrollTop;els.highlightLayer.scrollLeft=els.decodeInput.scrollLeft};els.decodeInput.addEventListener("scroll",syncScroll);els.decodeInput.addEventListener("input",()=>{els.highlightLayer.innerHTML="";els.outDecodeBox.classList.remove("success");els.outDecodeText.textContent="Waiting to scan..."})
